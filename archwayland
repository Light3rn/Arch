#!/bin/bash

wantedname=$1
wm=$2

## Install wayland, wayland x compability support, wifi compability additions and better ntfs support for external drives and usb sticks
arch-chroot /mnt pacman --noconfirm -S wayland xorg-server-xwayland dialog wpa_supplicant ntfs-3g

## Install the desktop environment 
if (( $wm == 1)); then
arch-chroot /mnt pacman --noconfirm -S gnome gnome-tweak-tool gedit networkmanager
arch-chroot /mnt systemctl enable NetworkManager.service
echo $'if [[ -z $DISPLAY ]] && [[ $(tty) = /dev/tty1 ]] && [[ -z $XDG_SESSION_TYPE ]]; then\nXDG_SESSION_TYPE=wayland exec dbus-run-session gnome-session\nfi' >> /mnt/home/$wantedname/.bash_profile
elif (( $wm == 2)); then
arch-chroot /mnt pacman --noconfirm -S plasma-desktop plasma-wayland-session plasma-nm kate git 
arch-chroot /mnt systemctl enable NetworkManager.service
## Modify language here ~/.config/kxkbrc in future
echo $'if [[ -z $DISPLAY ]] && [[ $(tty) = /dev/tty1 ]] && [[ -z $XDG_SESSION_TYPE ]]; then\nstartplasmacompositor\nfi' >> /mnt/home/$wantedname/.bash_profile
else
arch-chroot /mnt pacman --noconfirm -S enlightenment terminology connman
arch-chroot /mnt systemctl enable connman.service
echo $'if [[ -z $DISPLAY ]] && [[ $(tty) = /dev/tty1 ]] && [[ -z $XDG_SESSION_TYPE ]]; then\nenlightenment_start\nfi' >> /mnt/home/$wantedname/.bash_profile
fi

## Install some favourite tools
arch-chroot /mnt pacman --noconfirm -S firefox git
arch-chroot /mnt pacman --noconfirm -S flashplugin unrar file-roller gst-plugins-ugly rustup npm qbittorrent vlc phonon-qt4-vlc mpd cantata minidlna libreoffice-still calibre fuseiso perl-image-exiftool pgadmin4
arch-chroot /mnt systemctl enable minidlna.service

## Send the background picture to home folder for using :)
cp ./dotfiles/archbackground.jpg /mnt/home/$wantedname/
